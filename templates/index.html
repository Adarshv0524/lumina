{% extends "base.html" %}

{% block content %}
<div class="hero-section">
    {% if user %}
        <!-- Authenticated User Interface -->
        <div class="welcome-back">
            <h2>Welcome back, {{ user.name or user.email }}! ðŸ‘‹</h2>
            <p>Ready to chat with your documents?</p>
            <div class="quick-actions">
                <a href="/chat" class="btn btn-primary btn-large">ðŸ’¬ Start Chatting</a>
                <a href="/upload" class="btn btn-secondary">ðŸ“„ Upload Documents</a>
            </div>
        </div>
        
        <!-- Chat Interface -->
        <div class="chat-interface">
            <div class="chat-messages" id="messages">
                <div class="message bot">
                    <strong>Lumina RAG:</strong> Hi! I can help you analyze your uploaded documents. Ask me anything!
                </div>
            </div>
            <div class="input-area">
                <input type="text" id="query-input" placeholder="Ask a question about your documents..." />
                <button class="send-btn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    {% else %}
        <!-- Landing Page for Unauthenticated Users -->
        <div class="hero">
            <h2>Your Personal AI Document Assistant</h2>
            <p>Upload documents and ask questions. Get intelligent answers powered by AI.</p>
            <button id="get-started-btn" class="btn btn-primary btn-large">Get Started</button>
        </div>

        <div class="features">
            <div class="feature-card">
                <h3>ðŸ“„ Smart Document Processing</h3>
                <p>Upload PDFs, PowerPoints, and images. Advanced OCR extracts text accurately.</p>
            </div>
            <div class="feature-card">
                <h3>ðŸ§  AI-Powered Q&A</h3>
                <p>Ask natural questions and get intelligent, contextual answers.</p>
            </div>
            <div class="feature-card">
                <h3>ðŸ’¬ Chat History</h3>
                <p>Track conversations and revisit previous insights easily.</p>
            </div>
        </div>
    {% endif %}
</div>

<script>
// Chat functionality for authenticated users
{% if user %}
function sendMessage() {
    const input = document.getElementById('query-input');
    const query = input.value.trim();
    
    if (!query) return;
    
    addMessage('user', query);
    input.value = '';
    
    addMessage('bot', 'Thinking...', 'typing');
    
    fetch('/query', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query: query })
    })
    .then(response => response.json())
    .then(data => {
        document.querySelector('.typing')?.remove();
        
        if (data.success) {
            addMessage('bot', data.answer);
        } else {
            addMessage('bot', 'Sorry, I encountered an error: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        document.querySelector('.typing')?.remove();
        addMessage('bot', 'Sorry, connection error. Please try again.');
    });
}

function addMessage(type, content, className = '') {
    const messages = document.getElementById('messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type} ${className}`;
    messageDiv.innerHTML = type === 'user' 
        ? `<strong>You:</strong> ${content}`
        : `<strong>Lumina RAG:</strong> ${content}`;
    
    messages.appendChild(messageDiv);
    messages.scrollTop = messages.scrollHeight;
    {% comment %} just making a comment to update {% endcomment %}
}

// Enter key support
document.getElementById('query-input')?.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        sendMessage();
    }
});
{% endif %}
</script>
{% endblock %}
